<% if can?(:manage, Service) and (controller.action_name == "new" or (controller.action_name == "create" and !@service.errors.empty?)) %>
  <div class="panel panel-default">
    <div class="panel-heading panel-title">New service</div>
    <div class="panel-body">
      <%= simple_form_for @service, :url => services_path, :html => { :remote => true } do |f| %>
        <%= f.input :name, input_html: { class: "form-user" } %>
        <%= f.input :title, input_html: { class: "form-user" } %>
        <%= f.input :redirect_uri, :label => 'Redirect URI', :input_html => { class: "form-user" } %>

        <div class="form-group">
          <%= f.submit "Save", class: "btn btn-default" %>
          <%= link_to "Cancel", services_path, { remote: true, class: "btn" } %>
        </div>
      <% end %>
    </div>
  </div>
<% else %>
  <div class="page-header">
    <div class="btn-toolbar pull-right">
      <% if can?(:manage, Service) %>
        <div class="btn-group btn-group-sm">
          <%= link_to icon("plus").html_safe, new_service_path, { remote: true, id: "new-oauth-service", class: "btn btn-default" } %>
        </div>
      <% end %>
    </div>
    <%= form_tag(services_path, :method => "get", :class => "form-inline text-center", :role => "form") do %>
      <div class="form-group">
        <%= search_field_tag :query, params[:query], :placeholder => "Search", :class => "form-control" %>
      </div>
      <button type="submit" class="btn btn-default hidden-xs"><%= icon("search") %></button>
      <% unless params[:query].blank? %>
        <%= link_to "clear", services_path, :class => "btn" %>
      <% end %>
    <% end %>
  </div>

  <% if @services.size > 0 %>
    <div class="panel-group" id="service">
      <% @services.each do |service| %>
        <div class="panel panel-default">
          <div class="panel-heading panel-title panel-list">
            <%= link_to h(service.title) + " <small class='pull-right'>#{service.name}</small>".html_safe, "#service_#{service.name}", :class => "accordion-toggle", :id => "link_#{service.name}", :data => { :toggle => "collapse", :parent => "#service" }, :href => "#service_#{service.name}" %>
          </div>
          <% if can?(:manage, @service) && @service && @service.name == service.name && (controller.action_name == "edit" or (controller.action_name == "update" and !@service.errors.empty?)) %>
            <div id="service_<%= service %>" class="panel-collapse collapse.in">
              <div class="panel-body">
                <%= simple_form_for @service, url: service_path(@service), html: { role: "form", remote: true } do |f| %>
                  <%= f.input :name, input_html: { class: "form-user" } %>
                  <%= f.input :title, input_html: { class: "form-user" } %>
                  <%= f.input :redirect_uri, :label => 'Redirect URI', :input_html => { class: "form-user" } %>

                  <div class="form-group">
                    <%= f.submit "Save ", class: "btn btn-default" %>
                    <%= link_to 'Cancel', services_path(query: params[:query]), { :remote => true, :class => 'btn' } %>
                  </div>
                <% end %>
              </div>
            </div>
          <% else %>
            <div id="service_<%= service.name %>" class="panel-collapse collapse">
              <div class="panel-body">
                <% if can?(:manage, Service) %>
                  <div class="btn-toolbar pull-right">
                    <div class="btn-group btn-group-sm">
                      <%= link_to icon("pencil").html_safe, edit_service_path(service.name, query: params[:query]), remote: true, class: 'btn btn-default btn-sm', id: "#{service.name}-edit" %>
                    </div>
                    <div class="btn-group btn-group-sm">
                      <%= link_to icon("trash").html_safe, service_path(service.name, query: params[:query]), method: :delete, data: { confirm: 'Are you sure?' }, remote: true, class: 'btn btn-default btn-sm', id: "#{service.name}-delete" %>
                    </div>
                  </div>
                <% end %>

                <h5>Redirect URL</h5>
                <%= link_to service.redirect_uri, "/services/#{service.name}" %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
    <div class="text-center">
      <%= will_paginate @services, :params => { :controller => services_path, query: params[:query] }, :renderer => BootstrapPagination::Rails %>
    </div>
  <% else %>
    <div class="alert alert-info">There are currently no services
      <% unless params[:query].blank? %>
          with <em><%= params[:query] %></em> in the name
      <% end %>
    </div>
  <% end %>
<% end %>
